<?php
$menu = [
    // Fresas con crema - Leche condensada
    ["id"=>1,"categoria"=>"Fresas con Crema","nombre"=>"Fresas con crema (250ml)","descripcion"=>"Con leche condensada","precio"=>12,"variante"=>"leche condensada","tamaño"=>"250ml","img"=>"assets/img/menu/fresasconcrema.jpg"],
    ["id"=>2,"categoria"=>"Fresas con Crema","nombre"=>"Fresas con crema (350ml)","descripcion"=>"Con leche condensada","precio"=>15,"variante"=>"leche condensada","tamaño"=>"350ml","img"=>"assets/img/menu/fresasconcrema.jpg"],
    ["id"=>3,"categoria"=>"Fresas con Crema","nombre"=>"Fresas con crema (500ml)","descripcion"=>"Con leche condensada","precio"=>20,"variante"=>"leche condensada","tamaño"=>"500ml","img"=>"assets/img/menu/fresasconcrema.jpg"],
    ["id"=>4,"categoria"=>"Fresas con Crema","nombre"=>"Fresas con crema (750ml)","descripcion"=>"Con leche condensada","precio"=>30,"variante"=>"leche condensada","tamaño"=>"750ml","img"=>"assets/img/menu/fresasconcrema.jpg"],

    // Fresas con crema - Nutella
    ["id"=>5,"categoria"=>"Fresas con Crema","nombre"=>"Fresas con crema Nutella (250ml)","descripcion"=>"Con Nutella","precio"=>15,"variante"=>"nutella","tamaño"=>"250ml","img"=>"assets/img/menu/frutasconcremanutella.jpg"],
    ["id"=>6,"categoria"=>"Fresas con Crema","nombre"=>"Fresas con crema Nutella (350ml)","descripcion"=>"Con Nutella","precio"=>18,"variante"=>"nutella","tamaño"=>"350ml","img"=>"assets/img/menu/frutasconcremanutella.jpg"],
    ["id"=>7,"categoria"=>"Fresas con Crema","nombre"=>"Fresas con crema Nutella (500ml)","descripcion"=>"Con Nutella","precio"=>25,"variante"=>"nutella","tamaño"=>"500ml","img"=>"assets/img/menu/frutasconcremanutella.jpg"],
    ["id"=>8,"categoria"=>"Fresas con Crema","nombre"=>"Fresas con crema Nutella (750ml)","descripcion"=>"Con Nutella","precio"=>36,"variante"=>"nutella","tamaño"=>"750ml","img"=>"assets/img/menu/frutasconcremanutella.jpg"],

    // Durazno con crema - Leche condensada
    ["id"=>9,"categoria"=>"Durazno con Crema","nombre"=>"Durazno con crema (250ml)","descripcion"=>"Con leche condensada","precio"=>15,"variante"=>"leche condensada","tamaño"=>"250ml","img"=>"assets/img/menu/duraznoconcrema.jpg"],
    ["id"=>10,"categoria"=>"Durazno con Crema","nombre"=>"Durazno con crema (350ml)","descripcion"=>"Con leche condensada","precio"=>18,"variante"=>"leche condensada","tamaño"=>"350ml","img"=>"assets/img/menu/duraznoconcrema.jpg"],
    ["id"=>11,"categoria"=>"Durazno con Crema","nombre"=>"Durazno con crema (500ml)","descripcion"=>"Con leche condensada","precio"=>25,"variante"=>"leche condensada","tamaño"=>"500ml","img"=>"assets/img/menu/duraznoconcrema.jpg"],
    ["id"=>12,"categoria"=>"Durazno con Crema","nombre"=>"Durazno con crema (750ml)","descripcion"=>"Con leche condensada","precio"=>35,"variante"=>"leche condensada","tamaño"=>"750ml","img"=>"assets/img/menu/duraznoconcrema.jpg"],
    
    // Durazno con crema - Nutella
    ["id"=>13,"categoria"=>"Durazno con Crema","nombre"=>"Durazno con crema Nutella (250ml)","descripcion"=>"Con Nutella","precio"=>18,"variante"=>"nutella","tamaño"=>"250ml","img"=>"assets/img/menu/duraznoconcremanutella.jpg"],
    ["id"=>14,"categoria"=>"Durazno con Crema","nombre"=>"Durazno con crema Nutella (350ml)","descripcion"=>"Con Nutella","precio"=>22,"variante"=>"nutella","tamaño"=>"350ml","img"=>"assets/img/menu/duraznoconcremanutella.jpg"],
    ["id"=>15,"categoria"=>"Durazno con Crema","nombre"=>"Durazno con crema Nutella (500ml)","descripcion"=>"Con Nutella","precio"=>30,"variante"=>"nutella","tamaño"=>"500ml","img"=>"assets/img/menu/duraznoconcremanutella.jpg"],
    ["id"=>16,"categoria"=>"Durazno con Crema","nombre"=>"Durazno con crema Nutella (750ml)","descripcion"=>"Con Nutella","precio"=>40,"variante"=>"nutella","tamaño"=>"750ml","img"=>"assets/img/menu/duraznoconcremanutella.jpg"],

    // Fresas con crema + helado - Leche condensada
    ["id"=>17,"categoria"=>"Fresas con Crema + Helado","nombre"=>"Fresas con crema + helado (250ml)","descripcion"=>"Con leche condensada","precio"=>15,"variante"=>"leche condensada","tamaño"=>"250ml","img"=>"assets/img/menu/fresasconcrema+helado.jpg"],
    ["id"=>18,"categoria"=>"Fresas con Crema + Helado","nombre"=>"Fresas con crema + helado (350ml)","descripcion"=>"Con leche condensada","precio"=>20,"variante"=>"leche condensada","tamaño"=>"350ml","img"=>"assets/img/menu/fresasconcrema+helado.jpg"],

    // Fresas con crema + helado - Nutella
    ["id"=>19,"categoria"=>"Fresas con Crema + Helado","nombre"=>"Fresas con crema + helado Nutella (250ml)","descripcion"=>"Con Nutella","precio"=>20,"variante"=>"nutella","tamaño"=>"250ml","img"=>"assets/img/menu/fresasconcrema+helado.jpg"],
    ["id"=>20,"categoria"=>"Fresas con Crema + Helado","nombre"=>"Fresas con crema + helado Nutella (350ml)","descripcion"=>"Con Nutella","precio"=>25,"variante"=>"nutella","tamaño"=>"350ml","img"=>"assets/img/menu/fresasconcrema+helado.jpg"],

    // Arroz con leche - Leche condensada o Dulce de leche
    ["id"=>21,"categoria"=>"Arroz con Leche","nombre"=>"Arroz con leche (250ml)","descripcion"=>"Con leche condensada o dulce de leche","precio"=>10,"variante"=>"leche condensada/dulce","tamaño"=>"250ml","img"=>"assets/img/menu/arrozconlechecondensada.jpg"],
    ["id"=>22,"categoria"=>"Arroz con Leche","nombre"=>"Arroz con leche (350ml)","descripcion"=>"Con leche condensada o dulce de leche","precio"=>15,"variante"=>"leche condensada/dulce","tamaño"=>"350ml","img"=>"assets/img/menu/arrozconlechecondensada.jpg"],
    ["id"=>23,"categoria"=>"Arroz con Leche","nombre"=>"Arroz con leche (500ml)","descripcion"=>"Con leche condensada o dulce de leche","precio"=>20,"variante"=>"leche condensada/dulce","tamaño"=>"500ml","img"=>"assets/img/menu/arrozconlechecondensada.jpg"],
    ["id"=>24,"categoria"=>"Arroz con Leche","nombre"=>"Arroz con leche (750ml)","descripcion"=>"Con leche condensada o dulce de leche","precio"=>30,"variante"=>"leche condensada/dulce","tamaño"=>"750ml","img"=>"assets/img/menu/arrozconlechecondensada.jpg"],

    // Arroz con leche - Nutella
    ["id"=>25,"categoria"=>"Arroz con Leche","nombre"=>"Arroz con leche Nutella (250ml)","descripcion"=>"Con Nutella","precio"=>12,"variante"=>"nutella","tamaño"=>"250ml","img"=>"assets/img/menu/arrozconlechenutella.jpg"],
    ["id"=>26,"categoria"=>"Arroz con Leche","nombre"=>"Arroz con leche Nutella (350ml)","descripcion"=>"Con Nutella","precio"=>17,"variante"=>"nutella","tamaño"=>"350ml","img"=>"assets/img/menu/arrozconlechenutella.jpg"],
    ["id"=>27,"categoria"=>"Arroz con Leche","nombre"=>"Arroz con leche Nutella (500ml)","descripcion"=>"Con Nutella","precio"=>22,"variante"=>"nutella","tamaño"=>"500ml","img"=>"assets/img/menu/arrozconlechenutella.jpg"],
    ["id"=>28,"categoria"=>"Arroz con Leche","nombre"=>"Arroz con leche Nutella (750ml)","descripcion"=>"Con Nutella","precio"=>32,"variante"=>"nutella","tamaño"=>"750ml","img"=>"assets/img/menu/arrozconlechenutella.jpg"],
];

$toppings = [
    ["nombre"=>"Gotas de chocolate","emoji"=>"🍫","color"=>"#6F4E37"],
    ["nombre"=>"Piña","emoji"=>"🍍","color"=>"#FFD700"],
    ["nombre"=>"Fresas","emoji"=>"🍓","color"=>"#FF6B6B"],
    ["nombre"=>"Kiwi","emoji"=>"🥝","color"=>"#8BC34A"],
    ["nombre"=>"Durazno","emoji"=>"🍑","color"=>"#FFB347"],
    ["nombre"=>"Gomitas","emoji"=>"🍬","color"=>"#FF69B4"],
    ["nombre"=>"Chubis","emoji"=>"🍭","color"=>"#FF1493"],
    ["nombre"=>"Huevos de chocolate","emoji"=>"🥚","color"=>"#8B4513"],
    ["nombre"=>"Huevos de chocolate blanco","emoji"=>"🤍","color"=>"#F5F5DC"],
    ["nombre"=>"Chocolate","emoji"=>"🍫","color"=>"#3E2723"],
    ["nombre"=>"Donas","emoji"=>"🍩","color"=>"#FF6EC7"],
    ["nombre"=>"Cereal","emoji"=>"🥣","color"=>"#FFA726"],
];

$whatsapp = "59171234567";
?><!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Menú - ACAI LIFE</title>
  <link rel="stylesheet" href="assets/css/common.css" />
  <link rel="stylesheet" href="assets/css/menu.css" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <img src="assets/img/logo-acai.jpg" alt="Acai Life logo" class="logo">
        <div>
          <h1>ACAI LIFE</h1>
          <p class="tag">Snacks saludables · Sacaba</p>
        </div>
      </div>
      <nav class="main-nav">
        <a href="index.php">Inicio</a>
        <a href="menu.php">Menú</a>
        <a href="promociones.php">Promociones</a>
        <a href="ubicacion.php">Ubicación</a>
        <a href="contacto.php">Contacto</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="container menu-section">
      <h3>Nuestro Menú Completo</h3>
      <div class="menu-controls">
        <label>Categoría:
          <select id="filtro-categoria">
            <option value="all">Todas las categorías</option>
            <?php
              $cats = array_unique(array_map(fn($m)=>$m['categoria'],$menu));
              foreach ($cats as $c) echo "<option value=\"" . htmlspecialchars($c) . "\">" . htmlspecialchars($c) . "</option>";
            ?>
          </select>
        </label>
        <label>Tamaño:
          <select id="filtro-tamaño">
            <option value="all">Todos los tamaños</option>
            <option value="250ml">250ml</option>
            <option value="350ml">350ml</option>
            <option value="500ml">500ml</option>
            <option value="750ml">750ml</option>
          </select>
        </label>
        <input id="search" placeholder="Buscar producto..." />
      </div>

      <div id="menu-grid" class="menu-grid">
        <?php foreach($menu as $item): ?>
          <article class="menu-item" 
                   data-categoria="<?=htmlspecialchars($item['categoria'])?>"
                   data-tamaño="<?=htmlspecialchars($item['tamaño'])?>"
                   data-nombre="<?=htmlspecialchars(strtolower($item['nombre']))?>"
                   data-precio="<?=$item['precio']?>">
            <img src="<?=htmlspecialchars($item['img'])?>" alt="<?=htmlspecialchars($item['nombre'])?>" loading="lazy">
            <div class="menu-info">
              <h4><?=htmlspecialchars($item['nombre'])?></h4>
              <p class="desc"><?=htmlspecialchars($item['descripcion'])?></p>
              <div class="menu-badges">
                <span class="badge size-badge"><?=htmlspecialchars($item['tamaño'])?></span>
                <span class="badge variant-badge"><?=htmlspecialchars($item['variante'])?></span>
              </div>
              
              <!-- Sección de Toppings -->
              <div class="toppings-section">
                <button class="toppings-toggle" onclick="toggleToppings(this)">
                  <span class="toggle-icon">+</span> Agregar Toppings (+2 Bs c/u)
                </button>
                <div class="toppings-container" style="display:none;">
                  <div class="toppings-grid">
                    <?php foreach($toppings as $topping): ?>
                      <label class="topping-item">
                        <input type="checkbox" name="topping" value="<?=htmlspecialchars($topping['nombre'])?>" onchange="updatePrice(this)">
                        <span class="topping-emoji" style="background:<?=$topping['color']?>20;border:2px solid <?=$topping['color']?>">
                          <?=$topping['emoji']?>
                        </span>
                        <span class="topping-name"><?=htmlspecialchars($topping['nombre'])?></span>
                      </label>
                    <?php endforeach; ?>
                  </div>
                  <div class="toppings-summary">
                    <span class="toppings-count">0 toppings seleccionados</span>
                  </div>
                </div>
              </div>

              <div class="meta">
                <div class="price-container">
                  <span class="price"><?=$item['precio']?> Bs</span>
                  <span class="price-extra" style="display:none;">+0 Bs</span>
                </div>
                <button class="btn small order-btn" onclick="orderProduct(this)">Pedir ahora</button>
              </div>
            </div>
          </article>
        <?php endforeach; ?>
      </div>
      
      <div id="no-results" style="display:none;text-align:center;padding:3rem 1rem;color:var(--blanco);">
        <p style="font-size:1.2rem;margin-bottom:0.5rem;">😕 No se encontraron productos</p>
        <p style="opacity:0.8;">Intenta con otros filtros o búsqueda</p>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>© <?=date('Y')?> Acai Life · Hecho por Liz & Aracely</p>
    </div>
  </footer>

  <script>
    const whatsappNumber = "<?=$whatsapp?>";

    // Filtros y búsqueda
    const menuItems = document.querySelectorAll('.menu-item');
    const filtroCategoria = document.getElementById('filtro-categoria');
    const filtroTamaño = document.getElementById('filtro-tamaño');
    const searchInput = document.getElementById('search');
    const noResults = document.getElementById('no-results');

    function filterItems() {
      const categoriaSeleccionada = filtroCategoria.value;
      const tamañoSeleccionado = filtroTamaño.value;
      const searchTerm = searchInput.value.toLowerCase().trim();
      let visibleCount = 0;

      menuItems.forEach(item => {
        const categoria = item.getAttribute('data-categoria');
        const tamaño = item.getAttribute('data-tamaño');
        const nombre = item.getAttribute('data-nombre');

        const matchCategoria = categoriaSeleccionada === 'all' || categoria === categoriaSeleccionada;
        const matchTamaño = tamañoSeleccionado === 'all' || tamaño === tamañoSeleccionado;
        const matchSearch = searchTerm === '' || nombre.includes(searchTerm);

        if (matchCategoria && matchTamaño && matchSearch) {
          item.style.display = 'flex';
          visibleCount++;
        } else {
          item.style.display = 'none';
        }
      });

      if (visibleCount === 0) {
        noResults.style.display = 'block';
      } else {
        noResults.style.display = 'none';
      }
    }

    filtroCategoria.addEventListener('change', filterItems);
    filtroTamaño.addEventListener('change', filterItems);
    searchInput.addEventListener('input', filterItems);

    // Toggle de toppings
    function toggleToppings(button) {
      const container = button.nextElementSibling;
      const icon = button.querySelector('.toggle-icon');
      
      if (container.style.display === 'none') {
        container.style.display = 'block';
        icon.textContent = '−';
        button.classList.add('active');
      } else {
        container.style.display = 'none';
        icon.textContent = '+';
        button.classList.remove('active');
      }
    }

    // Actualizar precio con toppings
    function updatePrice(checkbox) {
      const menuItem = checkbox.closest('.menu-item');
      const basePrice = parseInt(menuItem.getAttribute('data-precio'));
      const checkboxes = menuItem.querySelectorAll('input[name="topping"]:checked');
      const toppingsCount = checkboxes.length;
      const extraPrice = toppingsCount * 2;
      const totalPrice = basePrice + extraPrice;

      const priceElement = menuItem.querySelector('.price');
      const priceExtra = menuItem.querySelector('.price-extra');
      const toppingsCountElement = menuItem.querySelector('.toppings-count');

      priceElement.textContent = totalPrice + ' Bs';
      
      if (extraPrice > 0) {
        priceExtra.textContent = '+' + extraPrice + ' Bs';
        priceExtra.style.display = 'inline';
        toppingsCountElement.textContent = toppingsCount + ' topping' + (toppingsCount > 1 ? 's' : '') + ' seleccionado' + (toppingsCount > 1 ? 's' : '');
        toppingsCountElement.style.color = '#4CAF50';
        toppingsCountElement.style.fontWeight = '700';
      } else {
        priceExtra.style.display = 'none';
        toppingsCountElement.textContent = '0 toppings seleccionados';
        toppingsCountElement.style.color = '#999';
        toppingsCountElement.style.fontWeight = '600';
      }
    }

    // Realizar pedido con toppings
    function orderProduct(button) {
      const menuItem = button.closest('.menu-item');
      const productName = menuItem.querySelector('h4').textContent;
      const priceElement = menuItem.querySelector('.price');
      const totalPrice = priceElement.textContent;
      
      const selectedToppings = Array.from(menuItem.querySelectorAll('input[name="topping"]:checked'))
        .map(cb => cb.value);

      let message = `Hola, quiero pedir:%0A*${productName}*%0APrecio: ${totalPrice}`;
      
      if (selectedToppings.length > 0) {
        message += '%0A%0A*Toppings:*%0A- ' + selectedToppings.join('%0A- ');
      }

      const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${message}`;
      window.open(whatsappUrl, '_blank');
    }
  </script>
</body>
</html>